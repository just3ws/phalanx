{
  "$ref": "#/definitions/ActionResult",
  "definitions": {
    "ActionResult": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "ok": {
              "type": "boolean",
              "const": true
            },
            "state": {
              "type": "object",
              "properties": {
                "players": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "player": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "name": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 50
                          }
                        },
                        "required": [
                          "id",
                          "name"
                        ],
                        "additionalProperties": false
                      },
                      "hand": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "suit": {
                              "type": "string",
                              "enum": [
                                "spades",
                                "hearts",
                                "diamonds",
                                "clubs"
                              ]
                            },
                            "rank": {
                              "type": "string",
                              "enum": [
                                "A",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "T",
                                "J",
                                "Q",
                                "K"
                              ]
                            }
                          },
                          "required": [
                            "suit",
                            "rank"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "battlefield": {
                        "type": "array",
                        "items": {
                          "anyOf": [
                            {
                              "type": "object",
                              "properties": {
                                "card": {
                                  "type": "object",
                                  "properties": {
                                    "suit": {
                                      "type": "string",
                                      "enum": [
                                        "spades",
                                        "hearts",
                                        "diamonds",
                                        "clubs"
                                      ]
                                    },
                                    "rank": {
                                      "type": "string",
                                      "enum": [
                                        "A",
                                        "2",
                                        "3",
                                        "4",
                                        "5",
                                        "6",
                                        "7",
                                        "8",
                                        "9",
                                        "T",
                                        "J",
                                        "Q",
                                        "K"
                                      ]
                                    }
                                  },
                                  "required": [
                                    "suit",
                                    "rank"
                                  ],
                                  "additionalProperties": false
                                },
                                "position": {
                                  "type": "object",
                                  "properties": {
                                    "row": {
                                      "type": "integer",
                                      "minimum": 0,
                                      "maximum": 1
                                    },
                                    "col": {
                                      "type": "integer",
                                      "minimum": 0,
                                      "maximum": 3
                                    }
                                  },
                                  "required": [
                                    "row",
                                    "col"
                                  ],
                                  "additionalProperties": false
                                },
                                "currentHp": {
                                  "type": "integer",
                                  "minimum": 0
                                },
                                "faceDown": {
                                  "type": "boolean"
                                }
                              },
                              "required": [
                                "card",
                                "position",
                                "currentHp",
                                "faceDown"
                              ],
                              "additionalProperties": false
                            },
                            {
                              "type": "null"
                            }
                          ]
                        },
                        "minItems": 8,
                        "maxItems": 8
                      },
                      "drawpile": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "suit": {
                              "type": "string",
                              "enum": [
                                "spades",
                                "hearts",
                                "diamonds",
                                "clubs"
                              ]
                            },
                            "rank": {
                              "type": "string",
                              "enum": [
                                "A",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "T",
                                "J",
                                "Q",
                                "K"
                              ]
                            }
                          },
                          "required": [
                            "suit",
                            "rank"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "discardPile": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "suit": {
                              "type": "string",
                              "enum": [
                                "spades",
                                "hearts",
                                "diamonds",
                                "clubs"
                              ]
                            },
                            "rank": {
                              "type": "string",
                              "enum": [
                                "A",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "T",
                                "J",
                                "Q",
                                "K"
                              ]
                            }
                          },
                          "required": [
                            "suit",
                            "rank"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "lifepoints": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "handCount": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "drawpileCount": {
                        "type": "integer",
                        "minimum": 0
                      }
                    },
                    "required": [
                      "player",
                      "hand",
                      "battlefield",
                      "drawpile",
                      "discardPile",
                      "lifepoints"
                    ],
                    "additionalProperties": false
                  },
                  "minItems": 2,
                  "maxItems": 2
                },
                "activePlayerIndex": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 1
                },
                "phase": {
                  "type": "string",
                  "enum": [
                    "setup",
                    "deployment",
                    "combat",
                    "reinforcement",
                    "gameOver"
                  ]
                },
                "turnNumber": {
                  "type": "integer",
                  "minimum": 0
                },
                "rngSeed": {
                  "type": "number"
                },
                "deploymentOrder": {
                  "type": "array",
                  "items": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 1
                  }
                },
                "reinforcement": {
                  "type": "object",
                  "properties": {
                    "column": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 3
                    },
                    "attackerIndex": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 1
                    }
                  },
                  "required": [
                    "column",
                    "attackerIndex"
                  ],
                  "additionalProperties": false
                },
                "transactionLog": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "sequenceNumber": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "action": {
                        "anyOf": [
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "deploy"
                              },
                              "playerIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 1
                              },
                              "card": {
                                "type": "object",
                                "properties": {
                                  "suit": {
                                    "type": "string",
                                    "enum": [
                                      "spades",
                                      "hearts",
                                      "diamonds",
                                      "clubs"
                                    ]
                                  },
                                  "rank": {
                                    "type": "string",
                                    "enum": [
                                      "A",
                                      "2",
                                      "3",
                                      "4",
                                      "5",
                                      "6",
                                      "7",
                                      "8",
                                      "9",
                                      "T",
                                      "J",
                                      "Q",
                                      "K"
                                    ]
                                  }
                                },
                                "required": [
                                  "suit",
                                  "rank"
                                ],
                                "additionalProperties": false
                              },
                              "column": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 3
                              }
                            },
                            "required": [
                              "type",
                              "playerIndex",
                              "card",
                              "column"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "attack"
                              },
                              "playerIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 1
                              },
                              "attackerPosition": {
                                "type": "object",
                                "properties": {
                                  "row": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "maximum": 1
                                  },
                                  "col": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "maximum": 3
                                  }
                                },
                                "required": [
                                  "row",
                                  "col"
                                ],
                                "additionalProperties": false
                              },
                              "targetPosition": {
                                "type": "object",
                                "properties": {
                                  "row": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "maximum": 1
                                  },
                                  "col": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "maximum": 3
                                  }
                                },
                                "required": [
                                  "row",
                                  "col"
                                ],
                                "additionalProperties": false
                              }
                            },
                            "required": [
                              "type",
                              "playerIndex",
                              "attackerPosition",
                              "targetPosition"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "pass"
                              },
                              "playerIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 1
                              }
                            },
                            "required": [
                              "type",
                              "playerIndex"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "reinforce"
                              },
                              "playerIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 1
                              },
                              "card": {
                                "type": "object",
                                "properties": {
                                  "suit": {
                                    "type": "string",
                                    "enum": [
                                      "spades",
                                      "hearts",
                                      "diamonds",
                                      "clubs"
                                    ]
                                  },
                                  "rank": {
                                    "type": "string",
                                    "enum": [
                                      "A",
                                      "2",
                                      "3",
                                      "4",
                                      "5",
                                      "6",
                                      "7",
                                      "8",
                                      "9",
                                      "T",
                                      "J",
                                      "Q",
                                      "K"
                                    ]
                                  }
                                },
                                "required": [
                                  "suit",
                                  "rank"
                                ],
                                "additionalProperties": false
                              }
                            },
                            "required": [
                              "type",
                              "playerIndex",
                              "card"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "forfeit"
                              },
                              "playerIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 1
                              }
                            },
                            "required": [
                              "type",
                              "playerIndex"
                            ],
                            "additionalProperties": false
                          }
                        ]
                      },
                      "stateHashBefore": {
                        "type": "string"
                      },
                      "stateHashAfter": {
                        "type": "string"
                      },
                      "timestamp": {
                        "type": "string",
                        "format": "date-time"
                      },
                      "details": {
                        "anyOf": [
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "deploy"
                              },
                              "gridIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 7
                              },
                              "phaseAfter": {
                                "type": "string",
                                "enum": [
                                  "setup",
                                  "deployment",
                                  "combat",
                                  "reinforcement",
                                  "gameOver"
                                ]
                              }
                            },
                            "required": [
                              "type",
                              "gridIndex",
                              "phaseAfter"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "attack"
                              },
                              "combat": {
                                "type": "object",
                                "properties": {
                                  "turnNumber": {
                                    "type": "integer",
                                    "minimum": 0
                                  },
                                  "attackerPlayerIndex": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "maximum": 1
                                  },
                                  "attackerCard": {
                                    "type": "object",
                                    "properties": {
                                      "suit": {
                                        "type": "string",
                                        "enum": [
                                          "spades",
                                          "hearts",
                                          "diamonds",
                                          "clubs"
                                        ]
                                      },
                                      "rank": {
                                        "type": "string",
                                        "enum": [
                                          "A",
                                          "2",
                                          "3",
                                          "4",
                                          "5",
                                          "6",
                                          "7",
                                          "8",
                                          "9",
                                          "T",
                                          "J",
                                          "Q",
                                          "K"
                                        ]
                                      }
                                    },
                                    "required": [
                                      "suit",
                                      "rank"
                                    ],
                                    "additionalProperties": false
                                  },
                                  "targetColumn": {
                                    "type": "integer",
                                    "minimum": 0,
                                    "maximum": 3
                                  },
                                  "baseDamage": {
                                    "type": "integer"
                                  },
                                  "steps": {
                                    "type": "array",
                                    "items": {
                                      "type": "object",
                                      "properties": {
                                        "target": {
                                          "type": "string",
                                          "enum": [
                                            "frontCard",
                                            "backCard",
                                            "playerLp"
                                          ]
                                        },
                                        "card": {
                                          "type": "object",
                                          "properties": {
                                            "suit": {
                                              "type": "string",
                                              "enum": [
                                                "spades",
                                                "hearts",
                                                "diamonds",
                                                "clubs"
                                              ]
                                            },
                                            "rank": {
                                              "type": "string",
                                              "enum": [
                                                "A",
                                                "2",
                                                "3",
                                                "4",
                                                "5",
                                                "6",
                                                "7",
                                                "8",
                                                "9",
                                                "T",
                                                "J",
                                                "Q",
                                                "K"
                                              ]
                                            }
                                          },
                                          "required": [
                                            "suit",
                                            "rank"
                                          ],
                                          "additionalProperties": false
                                        },
                                        "incomingDamage": {
                                          "type": "integer"
                                        },
                                        "hpBefore": {
                                          "type": "integer"
                                        },
                                        "effectiveHp": {
                                          "type": "integer"
                                        },
                                        "absorbed": {
                                          "type": "integer"
                                        },
                                        "overflow": {
                                          "type": "integer"
                                        },
                                        "damage": {
                                          "type": "integer"
                                        },
                                        "hpAfter": {
                                          "type": "integer"
                                        },
                                        "destroyed": {
                                          "type": "boolean"
                                        },
                                        "lpBefore": {
                                          "type": "integer"
                                        },
                                        "lpAfter": {
                                          "type": "integer"
                                        },
                                        "bonuses": {
                                          "type": "array",
                                          "items": {
                                            "type": "string",
                                            "enum": [
                                              "aceInvulnerable",
                                              "aceVsAce",
                                              "diamondDeathShield",
                                              "clubDoubleOverflow",
                                              "spadeDoubleLp",
                                              "heartHalveLp"
                                            ]
                                          }
                                        }
                                      },
                                      "required": [
                                        "target",
                                        "incomingDamage",
                                        "damage"
                                      ],
                                      "additionalProperties": false
                                    }
                                  },
                                  "totalLpDamage": {
                                    "type": "integer"
                                  }
                                },
                                "required": [
                                  "turnNumber",
                                  "attackerPlayerIndex",
                                  "attackerCard",
                                  "targetColumn",
                                  "baseDamage",
                                  "steps",
                                  "totalLpDamage"
                                ],
                                "additionalProperties": false
                              },
                              "reinforcementTriggered": {
                                "type": "boolean"
                              },
                              "victoryTriggered": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "type",
                              "combat",
                              "reinforcementTriggered",
                              "victoryTriggered"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "pass"
                              }
                            },
                            "required": [
                              "type"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "reinforce"
                              },
                              "column": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 3
                              },
                              "gridIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 7
                              },
                              "cardsDrawn": {
                                "type": "integer",
                                "minimum": 0
                              },
                              "reinforcementComplete": {
                                "type": "boolean"
                              }
                            },
                            "required": [
                              "type",
                              "column",
                              "gridIndex",
                              "cardsDrawn",
                              "reinforcementComplete"
                            ],
                            "additionalProperties": false
                          },
                          {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "const": "forfeit"
                              },
                              "winnerIndex": {
                                "type": "integer",
                                "minimum": 0,
                                "maximum": 1
                              }
                            },
                            "required": [
                              "type",
                              "winnerIndex"
                            ],
                            "additionalProperties": false
                          }
                        ]
                      }
                    },
                    "required": [
                      "sequenceNumber",
                      "action",
                      "stateHashBefore",
                      "stateHashAfter",
                      "timestamp",
                      "details"
                    ],
                    "additionalProperties": false
                  }
                },
                "outcome": {
                  "type": "object",
                  "properties": {
                    "winnerIndex": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 1
                    },
                    "victoryType": {
                      "type": "string",
                      "enum": [
                        "lpDepletion",
                        "cardDepletion",
                        "forfeit"
                      ]
                    },
                    "turnNumber": {
                      "type": "integer",
                      "minimum": 0
                    }
                  },
                  "required": [
                    "winnerIndex",
                    "victoryType",
                    "turnNumber"
                  ],
                  "additionalProperties": false
                },
                "gameOptions": {
                  "type": "object",
                  "properties": {
                    "damageMode": {
                      "type": "string",
                      "enum": [
                        "cumulative",
                        "per-turn"
                      ],
                      "default": "cumulative"
                    }
                  },
                  "additionalProperties": false,
                  "default": {}
                }
              },
              "required": [
                "players",
                "activePlayerIndex",
                "phase",
                "turnNumber",
                "rngSeed"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "ok",
            "state"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "ok": {
              "type": "boolean",
              "const": false
            },
            "error": {
              "type": "string"
            },
            "code": {
              "type": "string"
            }
          },
          "required": [
            "ok",
            "error",
            "code"
          ],
          "additionalProperties": false
        }
      ]
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}
