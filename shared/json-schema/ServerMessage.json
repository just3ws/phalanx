{
  "$ref": "#/definitions/ServerMessage",
  "definitions": {
    "ServerMessage": {
      "anyOf": [
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "matchCreated"
            },
            "matchId": {
              "type": "string",
              "format": "uuid"
            },
            "playerId": {
              "type": "string",
              "format": "uuid"
            },
            "playerIndex": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1
            }
          },
          "required": [
            "type",
            "matchId",
            "playerId",
            "playerIndex"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "matchJoined"
            },
            "matchId": {
              "type": "string",
              "format": "uuid"
            },
            "playerId": {
              "type": "string",
              "format": "uuid"
            },
            "playerIndex": {
              "type": "integer",
              "minimum": 0,
              "maximum": 1
            }
          },
          "required": [
            "type",
            "matchId",
            "playerId",
            "playerIndex"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "gameState"
            },
            "matchId": {
              "type": "string",
              "format": "uuid"
            },
            "state": {
              "type": "object",
              "properties": {
                "players": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "player": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "name": {
                            "type": "string",
                            "minLength": 1,
                            "maxLength": 50
                          }
                        },
                        "required": [
                          "id",
                          "name"
                        ],
                        "additionalProperties": false
                      },
                      "hand": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "suit": {
                              "type": "string",
                              "enum": [
                                "spades",
                                "hearts",
                                "diamonds",
                                "clubs"
                              ]
                            },
                            "rank": {
                              "type": "string",
                              "enum": [
                                "A",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "T",
                                "J",
                                "Q",
                                "K"
                              ]
                            }
                          },
                          "required": [
                            "suit",
                            "rank"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "battlefield": {
                        "type": "array",
                        "items": {
                          "anyOf": [
                            {
                              "type": "object",
                              "properties": {
                                "card": {
                                  "type": "object",
                                  "properties": {
                                    "suit": {
                                      "type": "string",
                                      "enum": [
                                        "spades",
                                        "hearts",
                                        "diamonds",
                                        "clubs"
                                      ]
                                    },
                                    "rank": {
                                      "type": "string",
                                      "enum": [
                                        "A",
                                        "2",
                                        "3",
                                        "4",
                                        "5",
                                        "6",
                                        "7",
                                        "8",
                                        "9",
                                        "T",
                                        "J",
                                        "Q",
                                        "K"
                                      ]
                                    }
                                  },
                                  "required": [
                                    "suit",
                                    "rank"
                                  ],
                                  "additionalProperties": false
                                },
                                "position": {
                                  "type": "object",
                                  "properties": {
                                    "row": {
                                      "type": "integer",
                                      "minimum": 0,
                                      "maximum": 1
                                    },
                                    "col": {
                                      "type": "integer",
                                      "minimum": 0,
                                      "maximum": 3
                                    }
                                  },
                                  "required": [
                                    "row",
                                    "col"
                                  ],
                                  "additionalProperties": false
                                },
                                "currentHp": {
                                  "type": "integer",
                                  "minimum": 0
                                },
                                "faceDown": {
                                  "type": "boolean"
                                }
                              },
                              "required": [
                                "card",
                                "position",
                                "currentHp",
                                "faceDown"
                              ],
                              "additionalProperties": false
                            },
                            {
                              "type": "null"
                            }
                          ]
                        },
                        "minItems": 8,
                        "maxItems": 8
                      },
                      "drawpile": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "suit": {
                              "type": "string",
                              "enum": [
                                "spades",
                                "hearts",
                                "diamonds",
                                "clubs"
                              ]
                            },
                            "rank": {
                              "type": "string",
                              "enum": [
                                "A",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "T",
                                "J",
                                "Q",
                                "K"
                              ]
                            }
                          },
                          "required": [
                            "suit",
                            "rank"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "discardPile": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "suit": {
                              "type": "string",
                              "enum": [
                                "spades",
                                "hearts",
                                "diamonds",
                                "clubs"
                              ]
                            },
                            "rank": {
                              "type": "string",
                              "enum": [
                                "A",
                                "2",
                                "3",
                                "4",
                                "5",
                                "6",
                                "7",
                                "8",
                                "9",
                                "T",
                                "J",
                                "Q",
                                "K"
                              ]
                            }
                          },
                          "required": [
                            "suit",
                            "rank"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "lifepoints": {
                        "type": "integer",
                        "minimum": 0
                      }
                    },
                    "required": [
                      "player",
                      "hand",
                      "battlefield",
                      "drawpile",
                      "discardPile",
                      "lifepoints"
                    ],
                    "additionalProperties": false
                  },
                  "minItems": 2,
                  "maxItems": 2
                },
                "activePlayerIndex": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 1
                },
                "phase": {
                  "type": "string",
                  "enum": [
                    "setup",
                    "deployment",
                    "combat",
                    "reinforcement",
                    "gameOver"
                  ]
                },
                "turnNumber": {
                  "type": "integer",
                  "minimum": 0
                },
                "rngSeed": {
                  "type": "number"
                },
                "deploymentOrder": {
                  "type": "array",
                  "items": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 1
                  }
                },
                "reinforcement": {
                  "type": "object",
                  "properties": {
                    "column": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 3
                    },
                    "attackerIndex": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 1
                    }
                  },
                  "required": [
                    "column",
                    "attackerIndex"
                  ],
                  "additionalProperties": false
                },
                "combatLog": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "turnNumber": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "attackerPlayerIndex": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 1
                      },
                      "attackerCard": {
                        "type": "string"
                      },
                      "targetColumn": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 3
                      },
                      "baseDamage": {
                        "type": "integer"
                      },
                      "steps": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "target": {
                              "type": "string",
                              "enum": [
                                "frontCard",
                                "backCard",
                                "playerLp"
                              ]
                            },
                            "card": {
                              "type": "string"
                            },
                            "damage": {
                              "type": "integer"
                            },
                            "remainingHp": {
                              "type": "integer"
                            },
                            "destroyed": {
                              "type": "boolean"
                            },
                            "bonus": {
                              "type": "string"
                            }
                          },
                          "required": [
                            "target",
                            "damage"
                          ],
                          "additionalProperties": false
                        }
                      },
                      "totalLpDamage": {
                        "type": "integer"
                      }
                    },
                    "required": [
                      "turnNumber",
                      "attackerPlayerIndex",
                      "attackerCard",
                      "targetColumn",
                      "baseDamage",
                      "steps",
                      "totalLpDamage"
                    ],
                    "additionalProperties": false
                  }
                },
                "outcome": {
                  "type": "object",
                  "properties": {
                    "winnerIndex": {
                      "type": "integer",
                      "minimum": 0,
                      "maximum": 1
                    },
                    "victoryType": {
                      "type": "string",
                      "enum": [
                        "lpDepletion",
                        "cardDepletion",
                        "forfeit"
                      ]
                    },
                    "turnNumber": {
                      "type": "integer",
                      "minimum": 0
                    }
                  },
                  "required": [
                    "winnerIndex",
                    "victoryType",
                    "turnNumber"
                  ],
                  "additionalProperties": false
                }
              },
              "required": [
                "players",
                "activePlayerIndex",
                "phase",
                "turnNumber",
                "rngSeed"
              ],
              "additionalProperties": false
            }
          },
          "required": [
            "type",
            "matchId",
            "state"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "actionError"
            },
            "matchId": {
              "type": "string",
              "format": "uuid"
            },
            "error": {
              "type": "string"
            },
            "code": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "matchId",
            "error",
            "code"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "matchError"
            },
            "error": {
              "type": "string"
            },
            "code": {
              "type": "string"
            }
          },
          "required": [
            "type",
            "error",
            "code"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "opponentDisconnected"
            },
            "matchId": {
              "type": "string",
              "format": "uuid"
            }
          },
          "required": [
            "type",
            "matchId"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "const": "opponentReconnected"
            },
            "matchId": {
              "type": "string",
              "format": "uuid"
            }
          },
          "required": [
            "type",
            "matchId"
          ],
          "additionalProperties": false
        }
      ]
    }
  },
  "$schema": "http://json-schema.org/draft-07/schema#"
}
